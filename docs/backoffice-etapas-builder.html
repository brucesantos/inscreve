<!doctype html>
<html lang="pt">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sistema Inscreve da FGV Conhecimento, para inscrições em concursos">
    <title>Inscreve - FGV Conhecimento</title>
    <!-- CSS do date range picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
    <!-- Lib do Quill editor de rich text para fazer o termo de aceite -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- Nosso estilo -->
    <link href="styles/main.css" rel="stylesheet">
  </head>

  <body class="bg-light">
    <!-- também conhecido como navbar -->
    <nav class="navbar navbar-expand-lg fixed-top border-bottom" style="background-color: #233769;" data-bs-theme="dark">
        <div class="container">
            <a class="navbar-brand" href="backoffice-index.html">
                <img src="images/logo-fgv-conhecimento-inverse.svg" alt="fgv conhecimento" width="290">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
                <ul class="navbar-nav justify-content-end flex-grow-1">
                    <li class="nav-item ms-3">
                        <a class="nav-link " href="backoffice-index.html">Dashboard</a> 
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link " href="backoffice-clientes.html">Clientes</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link " href="backoffice-concursos.html">Concursos</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link " href="backoffice-candidatos.html">Candidatos</a>
                    </li>
                    <li class="nav-item dropdown ms-1 ms-lg-2">
                        <button class="btn btn-link dropdown-toggle opacity-75" data-bs-toggle="dropdown" aria-expanded="false" style="color: white; text-decoration: none;">
                            Eudes Penteado
                        </button>
                        <ul class="dropdown-menu" style="background-color: #132349;">
                            <li class="nav-item mx-2">
                                <a class="nav-link" href="cadastro.html">Dados Pessoais</a>
                            </li>
                            <li class="nav-item mx-2">
                                <a class="nav-link" href="#">Alterar Senha</a>
                            </li>
                            <li class="nav-item mx-2">
                                <a class="nav-link" href="index.html">Sair</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- serve para preencher o espaco do header, que por ter posição fixa, não ocupa espaço no DOM -->
    <div class="espacoHeader" style="height: 56px;"></div>

    <main class="container">

      <div class="mt-4 d-flex align-items-center justify-content-between">
        <div>
          <h1 class="fs-3 mb-0">Construtor de etapas</h1>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="backoffice-concursos.html">Concursos</a></li>
              <li class="breadcrumb-item"><a href="backoffice-concurso-exemplo.html">24786764896</a></li>
              <li class="breadcrumb-item"><a href="backoffice-concurso-exemplo.html">Etapas</a></li>
              <li class="breadcrumb-item active" aria-current="page">Cargo: Professor de matemática</li>
            </ol>
          </nav>
        </div>
        <div class="d-flex align-items-center gap-2">
          <div class="small me-1">
            <div class="text-end opacity-50">Salvo pela última vez</div>
            <div class="text-end opacity-75">
              <span>16/11/2023</span>
              <span>às</span>
              <span>15:34:32</span>
            </div>
          </div>
          <button type="button" class="btn btn-primary">Salvar</button>
          <button type="button" class="btn btn-outline-primary p-0" style="width: 38px; height: 38px;">
            <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13 6.125C10.4219 6.125 8.35156 7.29688 6.75 8.78125C5.22656 10.1875 4.21094 11.8281 3.66406 13C4.21094 14.1719 5.22656 15.8516 6.75 17.2578C8.35156 18.7422 10.4219 19.875 13 19.875C15.5391 19.875 17.6094 18.7422 19.2109 17.2578C20.7344 15.8516 21.7891 14.1719 22.2969 13C21.7891 11.8281 20.7344 10.1875 19.25 8.78125C17.6094 7.29688 15.5391 6.125 13 6.125ZM5.46094 7.41406C7.29688 5.69531 9.83594 4.25 13 4.25C16.125 4.25 18.6641 5.69531 20.5 7.41406C22.3359 9.13281 23.5469 11.125 24.1328 12.5312C24.25 12.8438 24.25 13.1953 24.1328 13.5078C23.5469 14.875 22.3359 16.9062 20.5 18.625C18.6641 20.3438 16.125 21.75 13 21.75C9.83594 21.75 7.29688 20.3438 5.46094 18.625C3.625 16.9062 2.41406 14.875 1.82812 13.5078C1.71094 13.1953 1.71094 12.8438 1.82812 12.5312C2.41406 11.125 3.625 9.09375 5.46094 7.41406ZM13 16.125C14.7188 16.125 16.125 14.7578 16.125 13C16.125 11.2812 14.7188 9.875 13 9.875C12.9609 9.875 12.9219 9.875 12.9219 9.875C12.9609 10.1094 13 10.3047 13 10.5C13 11.9062 11.8672 13 10.5 13C10.2656 13 10.0703 13 9.875 12.9219C9.875 12.9609 9.875 13 9.875 13C9.875 14.7578 11.2422 16.125 13 16.125ZM13 8C14.7578 8 16.3984 8.97656 17.2969 10.5C18.1953 12.0625 18.1953 13.9766 17.2969 15.5C16.3984 17.0625 14.7578 18 13 18C11.2031 18 9.5625 17.0625 8.66406 15.5C7.76562 13.9766 7.76562 12.0625 8.66406 10.5C9.5625 8.97656 11.2031 8 13 8Z" fill="currentColor"/>
            </svg>                
          </button>
        </div>
      </div>
      <div class="coluna-de-etapas">
        
      </div>
      
      <!-- Botão para adicionar nova etapa -->
      <div class="text-center">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalEtapas">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="me-2">
            <path d="M10 4.375V15.625M4.375 10H15.625" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Adicionar nova etapa
        </button>
      </div>
        
    </main>

    <!-- ================================= -->
    <!-- MODAIS ========================== -->
    <!-- ================================= -->

    <!-- modal de etapas -->
    <div class="modal fade" id="modalEtapas" aria-hidden="true" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Etapa</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="nomeEtapa" class="form-label">Nome da etapa</label>
              <input type="text" class="form-control" id="nomeEtapa" placeholder="Digite o nome da etapa">
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="dataInicio" class="form-label">Data e hora de início</label>
                <input type="datetime-local" class="form-control" id="dataInicio">
              </div>

              <div class="col-md-6 mb-3">
                <label for="dataFim" class="form-label">Data e hora de fim</label>
                <input type="datetime-local" class="form-control" id="dataFim">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- modal de componentes -->
    <div class="modal fade" id="modalComponentes" aria-hidden="true" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Escolha um Componente</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <input type="text" class="form-control" id="filtroComponentes" placeholder="Encontrar..." aria-label="Filtrar componentes">
            </div>
            <div id="opcoes-de-componentes-para-incluir" class="list-group">
              <!-- Arquivo -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalArquivo">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-arquivo.svg" alt="Ícone de Arquivo">
                </div>
                <div>
                  <div class="component-title fw-bold">Arquivo</div>
                  <div class="component-description text-muted">Envio de arquivos como imagens, pdfs, etc.</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>

              <!-- Celular -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalCelular">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-celular.svg" alt="Ícone de celular">
                </div>
                <div>
                  <div class="component-title fw-bold">Celular</div>
                  <div class="component-description text-muted">Número de celular com validação e máscara</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>

              <!-- CPF -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalCPF">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-numero.svg" alt="Ícone de número">
                </div>
                <div>
                  <div class="component-title fw-bold">CPF</div>
                  <div class="component-description text-muted">Número do CPF com validação</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>

              <!-- Data -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalData">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-data.svg" alt="Ícone de data">
                </div>
                <div>
                  <div class="component-title fw-bold">Data</div>
                  <div class="component-description text-muted">Seleciona um dia específico dentro dos limites definidos</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>

              <!-- Email -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalEmail">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-email.svg" alt="Ícone de email">
                </div>
                <div>
                  <div class="component-title fw-bold">Email</div>
                  <div class="component-description text-muted">Email com validação de formato</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>

              <!-- Lógica -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalLogica">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-logica.svg" alt="Ícone de lógica">
                </div>
                <div>
                  <div class="component-title fw-bold">Lógica</div>
                  <div class="component-description text-muted">Condicionais e regras de exibição</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>

              <!-- Municípios -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalMunicipios">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-municipio.svg" alt="Ícone de mapa">
                </div>
                <div>
                  <div class="component-title fw-bold">Municípios</div>
                  <div class="component-description text-muted">Lista de municípios por estado</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>

              <!-- NIS -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalNIS">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-numero.svg" alt="Ícone de número">
                </div>
                <div>
                  <div class="component-title fw-bold">NIS</div>
                  <div class="component-description text-muted">Número de Identificação Social com validação</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>

              <!-- Seleção -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalSelecao">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-selecao.svg" alt="Ícone de seleção">
                </div>
                <div>
                  <div class="component-title fw-bold">Seleção</div>
                  <div class="component-description text-muted">Lista de opções com seleção única</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg> 
                </div>
              </a>

              <!-- Texto -->
              <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalTexto">
                <div class="me-3">
                  <img src="componentes-etapas/icones-componentes-etapas/icone-texto.svg" alt="Ícone de texto">
                </div>
                <div>
                  <div class="component-title fw-bold">Texto</div>
                  <div class="component-description text-muted">Campo de texto com validações</div>
                </div>
                <div class="ms-auto">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </a>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- modais de opções dos componentes -->
    <!-- modal de CPF -->
    <div class="modal fade" id="modalCPF" aria-hidden="true" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="d-flex align-items-center gap-2">
                        <img src="componentes-etapas/icones-componentes-etapas/icone-numero.svg" alt="CPF">
                        <h5 class="modal-title">CPF</h5>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted">Número do CPF com validação.</p>
                    <!-- opções base para todos os componentes -->
                    <div class="mb-3">
                      <label for="pergunta" class="form-label">Pergunta*</label>
                      <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                    </div>
                    
                    <div class="mb-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                        <label class="form-check-label" for="campo-obrigatorio">
                          Campo obrigatório
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <label for="ajuda" class="form-label">Ajuda</label>
                      <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                    </div>
                    
                    <div class="mb-3">
                      <label for="aviso" class="form-label">Aviso</label>
                      <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                    </div>
                    
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnSalvarCPF">Salvar</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const btnSalvarCPF = document.getElementById('btnSalvarCPF');
    
        // Handle save button click
        btnSalvarCPF.addEventListener('click', function() {
            // Get the parent card where the create-child button was clicked
            const parentCard = document.querySelector('.card-de-etapa .criar-filho.active')?.closest('.card-de-etapa');
            if (parentCard) {
                const childrenContainer = parentCard.querySelector('.children');
                
                // Get form values
                const pergunta = document.getElementById('pergunta').value || 'Nova pergunta';
                const campoObrigatorio = document.getElementById('campo-obrigatorio').checked;
                const ajuda = document.getElementById('ajuda').value;
                const aviso = document.getElementById('aviso').value;
                
                // Create new input template with the form values
                const inputTemplate = createInputTemplate(pergunta);
                
                // Add the template to the children container
                childrenContainer.insertAdjacentHTML('beforeend', inputTemplate);
                
                // Initialize sortable for the new children container if not already initialized
                if (childrenContainer && !childrenContainer.sortable) {
                    Sortable.create(childrenContainer, {
                        animation: 150,
                        handle: '.drag-handle',
                        ghostClass: 'card-de-etapa-ghost',
                        chosenClass: 'card-de-etapa-chosen',
                        dragClass: 'card-de-etapa-drag',
                        group: 'nested',
                        onStart: function(evt) {
                            document.body.classList.add('dragging-card');
                        },
                        onEnd: function(evt) {
                            document.body.classList.remove('dragging-card');
                            const item = evt.item;
                            item.classList.add('highlight-card');
                            setTimeout(() => {
                                item.classList.remove('highlight-card');
                            }, 800);
                        }
                    });
                }
            }
    
            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalCPF'));
            modal.hide();
        });
    });
    </script>
    <!-- modal de NIS -->
        <div class="modal fade" id="modalNIS" aria-hidden="true" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="d-flex align-items-center gap-2">
                            <img src="componentes-etapas/icones-componentes-etapas/icone-numero.svg" alt="icone de numero">
                            <h5 class="modal-title">NIS</h5>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p class="text-muted">Número de Identificação Social com validação.</p>
                        <!-- opções base para todos os componentes -->
                        <div class="mb-3">
                          <label for="pergunta" class="form-label">Pergunta*</label>
                          <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                        </div>
                        
                        <div class="mb-3">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                            <label class="form-check-label" for="campo-obrigatorio">
                              Campo obrigatório
                          </div>
                        </div>
                        
                        <div class="mb-3">
                          <label for="ajuda" class="form-label">Ajuda</label>
                          <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                        </div>
                        
                        <div class="mb-3">
                          <label for="aviso" class="form-label">Aviso</label>
                          <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                        </div>
                        
                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary">Salvar</button>
                    </div>
                </div>
            </div>
        </div>
    <!-- modal de Municípios -->
            <div class="modal fade" id="modalMunicipios" aria-hidden="true" tabindex="-1">
                <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="d-flex align-items-center gap-2">
                                <img src="componentes-etapas/icones-componentes-etapas/icone-municipio.svg" alt="Municípios">
                                <h5 class="modal-title">Municípios do Brasil</h5>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info">
                                Este componente permite que os usuários selecionem um único município. Geralmente usado para determinar a escolha do local da prova. Selecione abaixo os municípios disponíveis para o usuário escolher.
                            </div>
            
                            <!-- opções base para todos os componentes -->
                            <div class="mb-3">
                              <label for="pergunta" class="form-label">Pergunta*</label>
                              <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                            </div>
                            
                            <div class="mb-3">
                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                                <label class="form-check-label" for="campo-obrigatorio">
                                  Campo obrigatório
                              </div>
                            </div>
                            
                            <div class="mb-3">
                              <label for="ajuda" class="form-label">Ajuda</label>
                              <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                            </div>
                            
                            <div class="mb-3">
                              <label for="aviso" class="form-label">Aviso</label>
                              <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                            </div>
                            
                            
            
                            <div class="mb-3">
                                <h6 class="mb-3">Configuração</h6>
            
                                <!-- Blocos de UF -->
                                <div id="blocosUF">
            
                                    <!-- Outros blocos de UF serão adicionados dinamicamente aqui -->
            
                                </div>
            
                                <!-- Botão para adicionar nova UF -->
                                <button type="button" class="btn btn-primary mt-2" id="btnAdicionarUF">
                                    Adicionar UF
                                </button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" id="btnSalvarMunicipios">Salvar</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <style>
            .bloco-uf {
                position: relative;
            }
            .municipios-dropdown {
                border-radius: 8px 8px 0 0 !important;
                margin: 0;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                max-height: 220px;
                overflow-y: auto;
                /* Remove border on bottom to connect visually */
                border-bottom: none !important;
            }
            .municipios-selecionados {
                flex-wrap: wrap !important;
            }
            </style>
            
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                const btnSalvarMunicipios = document.getElementById('btnSalvarMunicipios');
                const btnAdicionarUF = document.getElementById('btnAdicionarUF');
                const blocosUF = document.getElementById('blocosUF');
            
                // Template for new UF block
                function createUFBlock() {
                    const blockId = 'uf_' + Date.now();
                    return `
                        <div class="mb-3 bloco-uf" id="${blockId}">
                            <div class="input-group mb-2 align-items-center">
                                <select class="form-select uf-select" style="max-width: 80px;">
                                    <option selected>UF</option>
                                    <option>AC</option>
                                    <option>AL</option>
                                    <option>AP</option>
                                    <option>AM</option>
                                    <option>BA</option>
                                    <option>CE</option>
                                    <option>DF</option>
                                    <option>ES</option>
                                    <option>GO</option>
                                    <option>MA</option>
                                    <option>MT</option>
                                    <option>MS</option>
                                    <option>MG</option>
                                    <option>PA</option>
                                    <option>PB</option>
                                    <option>PR</option>
                                    <option>PE</option>
                                    <option>PI</option>
                                    <option>RJ</option>
                                    <option>RN</option>
                                    <option>RS</option>
                                    <option>RO</option>
                                    <option>RR</option>
                                    <option>SC</option>
                                    <option>SP</option>
                                    <option>SE</option>
                                    <option>TO</option>
                                </select>
                                <input type="text" class="form-control municipio-search" placeholder="Município..." disabled>
                                <div class="input-group-text">
                                    <input class="form-check-input todos-uf mt-0" type="checkbox" id="todosUF_${blockId}">
                                    <label class="form-check-label ms-2 mb-0" for="todosUF_${blockId}">Todos</label>
                                </div>
                                <button class="btn btn-outline-danger btn-remover-uf" type="button" title="Remover UF">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M10.5312 5.5C10.4375 5.5 10.375 5.5625 10.3125 5.625L9.71875 6.5H14.25L13.6562 5.625C13.625 5.5625 13.5312 5.5 13.4375 5.5H10.5312ZM16.0625 6.5H16.4688H18H18.25C18.6562 6.5 19 6.84375 19 7.25C19 7.6875 18.6562 8 18.25 8H17.875L17.125 18.1562C17.0312 19.2188 16.1875 20 15.125 20H8.84375C7.78125 20 6.9375 19.2188 6.84375 18.1562L6.09375 8H5.75C5.3125 8 5 7.6875 5 7.25C5 6.84375 5.3125 6.5 5.75 6.5H6H7.5H7.90625L9.0625 4.78125C9.375 4.3125 9.9375 4 10.5312 4H13.4375C14.0312 4 14.5938 4.3125 14.9062 4.78125L16.0625 6.5ZM16.375 8H7.59375L8.34375 18.0625C8.375 18.3125 8.59375 18.5 8.84375 18.5H15.125C15.375 18.5 15.5938 18.3125 15.625 18.0625L16.375 8Z" fill="currentColor"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="mb-2 d-flex gap-2 municipios-selecionados">
                                <!-- Municípios selecionados serão adicionados aqui -->
                            </div>
                        </div>
                    `;
                }
            
                // Add new UF block
                btnAdicionarUF.addEventListener('click', function() {
                    blocosUF.insertAdjacentHTML('beforeend', createUFBlock());
                });
            
                // Remove UF block
                blocosUF.addEventListener('click', function(e) {
                    if (e.target.closest('.btn-remover-uf')) {
                        const blocoUF = e.target.closest('.bloco-uf');
                        if (blocoUF) {
                            blocoUF.remove();
                        }
                    }
                });
            
                // Handle UF selection change
                blocosUF.addEventListener('change', async function(e) {
                    if (e.target.classList.contains('uf-select')) {
                        const blocoUF = e.target.closest('.bloco-uf');
                        const searchInput = blocoUF.querySelector('.municipio-search');
                        const selectedUF = e.target.value;
            
                        if (selectedUF === 'UF') {
                            searchInput.disabled = true;
                            searchInput.value = '';
                            return;
                        }
            
                        searchInput.disabled = false;
                        try {
                            const response = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${selectedUF}/municipios`);
                            const municipios = await response.json();
                            
                            // Store municipalities in the block for later use
                            blocoUF.dataset.municipios = JSON.stringify(municipios);
                        } catch (error) {
                            console.error('Erro ao buscar municípios:', error);
                        }
                    }
                });
            
                // Handle municipality search
                blocosUF.addEventListener('input', function(e) {
                    if (e.target.classList.contains('municipio-search')) {
                        const blocoUF = e.target.closest('.bloco-uf');
                        const searchInput = e.target;
                        const searchTerm = e.target.value.toLowerCase();
                        const municipios = JSON.parse(blocoUF.dataset.municipios || '[]');
                        
                        // Filter municipalities based on search term
                        const filteredMunicipios = municipios.filter(m => 
                            m.nome.toLowerCase().includes(searchTerm)
                        );
            
                        // Create or update dropdown with filtered results
                        let dropdown = blocoUF.querySelector('.municipios-dropdown');
                        if (!dropdown) {
                            dropdown = document.createElement('div');
                            dropdown.className = 'municipios-dropdown position-absolute bg-white border rounded shadow-sm';
                            dropdown.style.zIndex = '1000';
                            blocoUF.appendChild(dropdown);
                        }
            
                        // Position dropdown above the search input
                        dropdown.style.left = (searchInput.offsetLeft) + 'px';
                        dropdown.style.bottom = (blocoUF.offsetHeight - (searchInput.offsetTop)) + 'px';
                        dropdown.style.width = searchInput.offsetWidth + 'px';
                        dropdown.style.position = 'absolute';
                        dropdown.style.top = '';
            
                        if (searchTerm.length > 0 && filteredMunicipios.length > 0) {
                            dropdown.innerHTML = filteredMunicipios
                                .slice(0, 10)
                                .map((m, idx) => `
                                    <div class="p-2 hover-bg-light cursor-pointer municipio-option" data-municipio='${JSON.stringify(m)}' data-idx="${idx}">
                                        ${m.nome}
                                    </div>
                                `).join('');
                            dropdown.style.display = 'block';
                            dropdown.dataset.activeIdx = '0';
                            highlightDropdownOption(dropdown, 0);
                        } else {
                            dropdown.style.display = 'none';
                        }
                    }
                });
            
                // Keyboard navigation for dropdown
                blocosUF.addEventListener('keydown', function(e) {
                    if (e.target.classList.contains('municipio-search')) {
                        const blocoUF = e.target.closest('.bloco-uf');
                        const dropdown = blocoUF.querySelector('.municipios-dropdown');
                        if (!dropdown || dropdown.style.display !== 'block') return;
                        const options = dropdown.querySelectorAll('.municipio-option');
                        let activeIdx = parseInt(dropdown.dataset.activeIdx || '0', 10);
            
                        if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            if (activeIdx < options.length - 1) activeIdx++;
                            highlightDropdownOption(dropdown, activeIdx);
                            dropdown.dataset.activeIdx = activeIdx;
                        } else if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            if (activeIdx > 0) activeIdx--;
                            highlightDropdownOption(dropdown, activeIdx);
                            dropdown.dataset.activeIdx = activeIdx;
                        } else if (e.key === 'Enter') {
                            e.preventDefault();
                            if (options[activeIdx]) {
                                options[activeIdx].click();
                            }
                        } else if (e.key === 'Escape') {
                            dropdown.style.display = 'none';
                        }
                    }
                });
            
                function highlightDropdownOption(dropdown, idx) {
                    const options = dropdown.querySelectorAll('.municipio-option');
                    options.forEach((opt, i) => {
                        if (i === idx) {
                            opt.classList.add('bg-primary', 'text-white');
                        } else {
                            opt.classList.remove('bg-primary', 'text-white');
                        }
                    });
                }
            
                // Handle municipality selection
                blocosUF.addEventListener('click', function(e) {
                    const municipioItem = e.target.closest('[data-municipio]');
                    if (municipioItem) {
                        const blocoUF = municipioItem.closest('.bloco-uf');
                        const municipio = JSON.parse(municipioItem.dataset.municipio);
                        const municipiosContainer = blocoUF.querySelector('.municipios-selecionados');
                        
                        // Check if municipality is already selected
                        const existingMunicipio = municipiosContainer.querySelector(`[data-municipio-id="${municipio.id}"]`);
                        if (!existingMunicipio) {
                            const municipioChip = document.createElement('button');
                            municipioChip.type = 'button';
                            municipioChip.className = 'btn btn-outline-secondary rounded-pill d-flex align-items-center gap-2';
                            municipioChip.setAttribute('data-municipio-id', municipio.id);
                            municipioChip.innerHTML = `
                                <span class="city-name">${municipio.nome}</span>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 5.5C9.65625 5.5 7.53125 6.75 6.34375 8.75C5.1875 10.7812 5.1875 13.25 6.34375 15.25C7.53125 17.2812 9.65625 18.5 12 18.5C14.3125 18.5 16.4375 17.2812 17.625 15.25C18.7812 13.25 18.7812 10.7812 17.625 8.75C16.4375 6.75 14.3125 5.5 12 5.5ZM12 20C9.125 20 6.5 18.5 5.0625 16C3.625 13.5312 3.625 10.5 5.0625 8C6.5 5.53125 9.125 4 12 4C14.8438 4 17.4688 5.53125 18.9062 8C20.3438 10.5 20.3438 13.5312 18.9062 16C17.4688 18.5 14.8438 20 12 20ZM9.46875 9.46875C9.75 9.1875 10.2188 9.1875 10.5 9.46875L11.9688 10.9375L13.4375 9.46875C13.75 9.1875 14.2188 9.1875 14.5 9.46875C14.8125 9.78125 14.8125 10.25 14.5 10.5312L13.0312 12L14.5 13.4688C14.8125 13.7812 14.8125 14.25 14.5 14.5312C14.2188 14.8438 13.75 14.8438 13.4375 14.5312L11.9688 13.0625L10.5 14.5312C10.2188 14.8438 9.75 14.8438 9.46875 14.5312C9.15625 14.25 9.15625 13.7812 9.46875 13.4688L10.9375 12L9.46875 10.5312C9.15625 10.25 9.15625 9.78125 9.46875 9.46875Z" fill="currentColor"/>
                                </svg>
                            `;
                            
                            // Add click handler to remove municipality
                            municipioChip.addEventListener('click', function() {
                                this.remove();
                            });
                            
                            municipiosContainer.appendChild(municipioChip);
                        }
                        
                        // Clear search and hide dropdown
                        const searchInput = blocoUF.querySelector('.municipio-search');
                        searchInput.value = '';
                        const dropdown = blocoUF.querySelector('.municipios-dropdown');
                        if (dropdown) {
                            dropdown.style.display = 'none';
                        }
                    }
                });
            
                // Handle "Todos" checkbox
                blocosUF.addEventListener('change', async function(e) {
                    if (e.target.classList.contains('todos-uf')) {
                        const blocoUF = e.target.closest('.bloco-uf');
                        const ufSelect = blocoUF.querySelector('.uf-select');
                        const selectedUF = ufSelect.value;
                        
                        if (e.target.checked && selectedUF !== 'UF') {
                            try {
                                const response = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${selectedUF}/municipios`);
                                const municipios = await response.json();
                                const municipiosContainer = blocoUF.querySelector('.municipios-selecionados');
                                
                                // Clear existing municipalities
                                municipiosContainer.innerHTML = '';
                                
                                // Add all municipalities
                                municipios.forEach(municipio => {
                                    const municipioChip = document.createElement('button');
                                    municipioChip.type = 'button';
                                    municipioChip.className = 'btn btn-outline-secondary rounded-pill d-flex align-items-center gap-2';
                                    municipioChip.setAttribute('data-municipio-id', municipio.id);
                                    municipioChip.innerHTML = `
                                        <span class="city-name">${municipio.nome}</span>
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 5.5C9.65625 5.5 7.53125 6.75 6.34375 8.75C5.1875 10.7812 5.1875 13.25 6.34375 15.25C7.53125 17.2812 9.65625 18.5 12 18.5C14.3125 18.5 16.4375 17.2812 17.625 15.25C18.7812 13.25 18.7812 10.7812 17.625 8.75C16.4375 6.75 14.3125 5.5 12 5.5ZM12 20C9.125 20 6.5 18.5 5.0625 16C3.625 13.5312 3.625 10.5 5.0625 8C6.5 5.53125 9.125 4 12 4C14.8438 4 17.4688 5.53125 18.9062 8C20.3438 10.5 20.3438 13.5312 18.9062 16C17.4688 18.5 14.8438 20 12 20ZM9.46875 9.46875C9.75 9.1875 10.2188 9.1875 10.5 9.46875L11.9688 10.9375L13.4375 9.46875C13.75 9.1875 14.2188 9.1875 14.5 9.46875C14.8125 9.78125 14.8125 10.25 14.5 10.5312L13.0312 12L14.5 13.4688C14.8125 13.7812 14.8125 14.25 14.5 14.5312C14.2188 14.8438 13.75 14.8438 13.4375 14.5312L11.9688 13.0625L10.5 14.5312C10.2188 14.8438 9.75 14.8438 9.46875 14.5312C9.15625 14.25 9.15625 13.7812 9.46875 13.4688L10.9375 12L9.46875 10.5312C9.15625 10.25 9.15625 9.78125 9.46875 9.46875Z" fill="currentColor"/>
                                        </svg>
                                    `;
                                    
                                    // Add click handler to remove municipality
                                    municipioChip.addEventListener('click', function() {
                                        this.remove();
                                    });
                                    
                                    municipiosContainer.appendChild(municipioChip);
                                });
                            } catch (error) {
                                console.error('Erro ao buscar municípios:', error);
                            }
                        } else if (!e.target.checked) {
                            // Clear all municipalities when unchecking "Todos"
                            const municipiosContainer = blocoUF.querySelector('.municipios-selecionados');
                            municipiosContainer.innerHTML = '';
                        }
                    }
                });
            
                // Handle save button click
                btnSalvarMunicipios.addEventListener('click', function() {
                    // Get the parent card where the create-child button was clicked
                    const parentCard = document.querySelector('.card-de-etapa .criar-filho.active')?.closest('.card-de-etapa');
                    if (parentCard) {
                        const childrenContainer = parentCard.querySelector('.children');
                        
                        // Get form values
                        const pergunta = document.getElementById('pergunta').value || 'Nova pergunta';
                        const campoObrigatorio = document.getElementById('campo-obrigatorio').checked;
                        const ajuda = document.getElementById('ajuda').value;
                        const aviso = document.getElementById('aviso').value;
                        
                        // Create new input template with the form values
                        const inputTemplate = createInputTemplate(pergunta);
                        
                        // Add the template to the children container
                        childrenContainer.insertAdjacentHTML('beforeend', inputTemplate);
                        
                        // Initialize sortable for the new children container if not already initialized
                        if (childrenContainer && !childrenContainer.sortable) {
                            Sortable.create(childrenContainer, {
                                animation: 150,
                                handle: '.drag-handle',
                                ghostClass: 'card-de-etapa-ghost',
                                chosenClass: 'card-de-etapa-chosen',
                                dragClass: 'card-de-etapa-drag',
                                group: 'nested',
                                onStart: function(evt) {
                                    document.body.classList.add('dragging-card');
                                },
                                onEnd: function(evt) {
                                    document.body.classList.remove('dragging-card');
                                    const item = evt.item;
                                    item.classList.add('highlight-card');
                                    setTimeout(() => {
                                        item.classList.remove('highlight-card');
                                    }, 800);
                                }
                            });
                        }
                    }
            
                    // Close the modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalMunicipios'));
                    modal.hide();
                });
            });
            </script>
    <!-- modal de Texto -->
                <div class="modal fade" id="modalTexto" aria-hidden="true" tabindex="-1">
                    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <div class="d-flex align-items-center gap-2">
                                    <img src="componentes-etapas/icones-componentes-etapas/icone-texto.svg" alt="Texto">
                                    <h5 class="modal-title">Texto</h5>
                                </div>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p class="text-muted">Campo de texto com validações.</p>
                                <!-- opções base para todos os componentes -->
                                <div class="mb-3">
                                  <label for="pergunta" class="form-label">Pergunta*</label>
                                  <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                                </div>
                                
                                <div class="mb-3">
                                  <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                                    <label class="form-check-label" for="campo-obrigatorio">
                                      Campo obrigatório
                                  </div>
                                </div>
                                
                                <div class="mb-3">
                                  <label for="ajuda" class="form-label">Ajuda</label>
                                  <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                                </div>
                                
                                <div class="mb-3">
                                  <label for="aviso" class="form-label">Aviso</label>
                                  <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                                </div>
                                
                                
                                <div class="configuracoes">
                                    <h3>Configurações</h3>
                
                                    <!-- Limite mínimo de caracteres -->
                                    <div class="mb-3">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="habilitarMinimo">
                                            <label class="form-check-label d-flex justify-content-between align-items-center w-100" for="habilitarMinimo">
                                                <span>Limite mínimo de caracteres</span>
                                                <span class="badge bg-primary" id="minimoDisplay">10 caracteres</span>
                                            </label>
                                        </div>
                                        <input type="range" class="form-range" id="minimoCaracteres" 
                                               min="10" max="100" value="10" disabled
                                               oninput="this.nextElementSibling.value = this.value">
                                    </div>
                
                                    <!-- Limite máximo de caracteres -->
                                    <div class="mb-3">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="habilitarMaximo">
                                            <label class="form-check-label d-flex justify-content-between align-items-center w-100" for="habilitarMaximo">
                                                <span>Limite máximo de caracteres</span>
                                                <span class="badge bg-primary" id="maximoDisplay">100 caracteres</span>
                                            </label>
                                        </div>
                                        <input type="range" class="form-range" id="maximoCaracteres" 
                                               min="100" max="500" value="100" disabled
                                               oninput="this.nextElementSibling.value = this.value">
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary" id="btnSalvarTexto">Salvar</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Elementos do limite mínimo
                    const habilitarMinimo = document.getElementById('habilitarMinimo');
                    const minimoCaracteres = document.getElementById('minimoCaracteres');
                    const minimoDisplay = document.getElementById('minimoDisplay');
                
                    // Elementos do limite máximo
                    const habilitarMaximo = document.getElementById('habilitarMaximo');
                    const maximoCaracteres = document.getElementById('maximoCaracteres');
                    const maximoDisplay = document.getElementById('maximoDisplay');
                
                    // Habilitar/desabilitar limite mínimo
                    habilitarMinimo.addEventListener('change', function() {
                        minimoCaracteres.disabled = !this.checked;
                        minimoDisplay.style.opacity = this.checked ? '1' : '0.5';
                        if (!this.checked) {
                            minimoDisplay.textContent = 'Desabilitado';
                        } else {
                            minimoDisplay.textContent = `${minimoCaracteres.value} caracteres`;
                        }
                    });
                
                    // Habilitar/desabilitar limite máximo
                    habilitarMaximo.addEventListener('change', function() {
                        maximoCaracteres.disabled = !this.checked;
                        maximoDisplay.style.opacity = this.checked ? '1' : '0.5';
                        if (!this.checked) {
                            maximoDisplay.textContent = 'Desabilitado';
                        } else {
                            maximoDisplay.textContent = `${maximoCaracteres.value} caracteres`;
                        }
                    });
                
                    // Atualizar display do mínimo
                    minimoCaracteres.addEventListener('input', function() {
                        minimoDisplay.textContent = `${this.value} caracteres`;
                        // Garantir que o máximo seja sempre maior que o mínimo
                        if (habilitarMaximo.checked && parseInt(maximoCaracteres.value) <= parseInt(this.value)) {
                            maximoCaracteres.value = parseInt(this.value) + 1;
                            maximoDisplay.textContent = `${maximoCaracteres.value} caracteres`;
                        }
                    });
                
                    // Atualizar display do máximo
                    maximoCaracteres.addEventListener('input', function() {
                        maximoDisplay.textContent = `${this.value} caracteres`;
                        // Garantir que o mínimo seja sempre menor que o máximo
                        if (habilitarMinimo.checked && parseInt(minimoCaracteres.value) >= parseInt(this.value)) {
                            minimoCaracteres.value = parseInt(this.value) - 1;
                            minimoDisplay.textContent = `${minimoCaracteres.value} caracteres`;
                        }
                    });
                
                    // Configurar o botão de salvar
                    const btnSalvarTexto = document.getElementById('btnSalvarTexto');
                    if (btnSalvarTexto) {
                        btnSalvarTexto.addEventListener('click', function() {
                            // Obter os valores do formulário
                            const minimo = habilitarMinimo.checked ? parseInt(minimoCaracteres.value) : null;
                            const maximo = habilitarMaximo.checked ? parseInt(maximoCaracteres.value) : null;
                            
                            // Aqui você pode adicionar a lógica para salvar as configurações
                            
                            // Fechar o modal
                            const modal = bootstrap.Modal.getInstance(document.getElementById('modalTexto'));
                            modal.hide();
                        });
                    }
                });
                </script>
    <!-- modal de Seleção -->
                    <div class="modal fade" id="modalSelecao" aria-hidden="true" tabindex="-1">
                        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <div class="d-flex align-items-center gap-2">
                                        <img src="componentes-etapas/icones-componentes-etapas/icone-selecao.svg" alt="Seleção">
                                        <h5 class="modal-title">Seleção</h5>
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <p class="text-muted">Lista de duas ou mais opções, com resposta única ou múltipla.</p>
                                    <!-- opções base para todos os componentes -->
                                    <div class="mb-3">
                                      <label for="pergunta" class="form-label">Pergunta*</label>
                                      <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                      <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                                        <label class="form-check-label" for="campo-obrigatorio">
                                          Campo obrigatório
                                      </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                      <label for="ajuda" class="form-label">Ajuda</label>
                                      <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                                    </div>
                                    
                                    <div class="mb-3">
                                      <label for="aviso" class="form-label">Aviso</label>
                                      <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                                    </div>
                                    
                                    
                                    <div class="configuracoes">
                                        <h3>Configurações</h3>
                                        
                                        <!-- Tipo de resposta -->
                                        <div class="mb-3 d-flex gap-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="tipoResposta" id="respostaUnica" value="unica" checked>
                                                <label class="form-check-label" for="respostaUnica">
                                                    Resposta única
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="tipoResposta" id="respostaMultipla" value="multipla">
                                                <label class="form-check-label" for="respostaMultipla">
                                                    Resposta Múltipla
                                                </label>
                                            </div>
                                        </div>
                    
                                        <!-- Opções -->
                                        <div class="mb-3">
                                            <label class="form-label">Opções</label>
                                            <div id="opcoesContainer" class="opcoes-container mb-2">
                                                <!-- As opções serão adicionadas aqui dinamicamente -->
                                            </div>
                                            <button type="button" class="btn btn-outline-primary" id="btnAdicionarOpcao">
                                                Adicionar Resposta
                                            </button>
                                        </div>
                    
                                        <!-- Campo "Outro" -->
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="campoOutro">
                                            <label class="form-check-label" for="campoOutro">
                                                Outro (opção que abre um campo de texto)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary" id="btnSalvarSelecao">Salvar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const btnSalvarSelecao = document.getElementById('btnSalvarSelecao');
                        const btnAdicionarOpcao = document.getElementById('btnAdicionarOpcao');
                        const opcoesContainer = document.getElementById('opcoesContainer');
                    
                        // Função para criar uma nova opção
                        function criarOpcao(valor = '') {
                            const opcaoDiv = document.createElement('div');
                            opcaoDiv.className = 'opcao-item d-flex align-items-center gap-2 mb-2';
                            opcaoDiv.innerHTML = `
                                <div class="drag-handle">
                                    <svg width="12" height="16" viewBox="0 0 12 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect width="12" height="16" fill="none"/>
                                        <path d="M2.25 13.75H3.75V12.25H2.25V13.75ZM2.25 15C1.53125 15 1 14.4688 1 13.75V12.25C1 11.5625 1.53125 11 2.25 11H3.75C4.4375 11 5 11.5625 5 12.25V13.75C5 14.4688 4.4375 15 3.75 15H2.25ZM8.25 13.75H9.75V12.25H8.25V13.75ZM8.25 15C7.53125 15 7 14.4688 7 13.75V12.25C7 11.5625 7.53125 11 8.25 11H9.75C10.4375 11 11 11.5625 11 12.25V13.75C11 14.4688 10.4375 15 9.75 15H8.25ZM2.25 7.25V8.75H3.75V7.25H2.25ZM1 8.75V7.25C1 6.5625 1.53125 6 2.25 6H3.75C4.4375 6 5 6.5625 5 7.25V8.75C5 9.46875 4.4375 10 3.75 10H2.25C1.53125 10 1 9.46875 1 8.75ZM8.25 8.75H9.75V7.25H8.25V8.75ZM8.25 10C7.53125 10 7 9.46875 7 8.75V7.25C7 6.5625 7.53125 6 8.25 6H9.75C10.4375 6 11 6.5625 11 7.25V8.75C11 9.46875 10.4375 10 9.75 10H8.25ZM2.25 2.25V3.75H3.75V2.25H2.25ZM1 3.75V2.25C1 1.5625 1.53125 1 2.25 1H3.75C4.4375 1 5 1.5625 5 2.25V3.75C5 4.46875 4.4375 5 3.75 5H2.25C1.53125 5 1 4.46875 1 3.75ZM8.25 3.75H9.75V2.25H8.25V3.75ZM8.25 5C7.53125 5 7 4.46875 7 3.75V2.25C7 1.5625 7.53125 1 8.25 1H9.75C10.4375 1 11 1.5625 11 2.25V3.75C11 4.46875 10.4375 5 9.75 5H8.25Z" fill="#9CA3AF"/>
                                    </svg>
                                </div>
                                <input type="text" class="form-control" value="${valor}" placeholder="Digite uma opção">
                                <button type="button" class="btn btn-outline-danger remover-opcao">
                                    Remover
                                </button>
                            `;
                    
                            // Adicionar evento para remover opção
                            opcaoDiv.querySelector('.remover-opcao').addEventListener('click', function() {
                                opcaoDiv.remove();
                            });
                    
                            return opcaoDiv;
                        }
                    
                        // Inicializar Sortable para as opções
                        new Sortable(opcoesContainer, {
                            animation: 150,
                            handle: '.drag-handle',
                            ghostClass: 'opcao-ghost',
                        });
                    
                        // Adicionar opção ao clicar no botão
                        btnAdicionarOpcao.addEventListener('click', function() {
                            opcoesContainer.appendChild(criarOpcao());
                        });
                    
                        // Adicionar duas opções iniciais
                        opcoesContainer.appendChild(criarOpcao('Sim'));
                        opcoesContainer.appendChild(criarOpcao('Não'));
                    
                        // Modificar o evento de salvar para incluir as opções
                        btnSalvarSelecao.addEventListener('click', function() {
                            const parentCard = document.querySelector('.card-de-etapa .criar-filho.active')?.closest('.card-de-etapa');
                            if (parentCard) {
                                const childrenContainer = parentCard.querySelector('.children');
                                
                                // Coletar valores do formulário
                                const pergunta = document.getElementById('pergunta').value || 'Nova pergunta';
                                const campoObrigatorio = document.getElementById('campo-obrigatorio').checked;
                                const ajuda = document.getElementById('ajuda').value;
                                const aviso = document.getElementById('aviso').value;
                                const tipoResposta = document.querySelector('input[name="tipoResposta"]:checked').value;
                                const campoOutro = document.getElementById('campoOutro').checked;
                                
                                // Coletar opções
                                const opcoes = Array.from(opcoesContainer.querySelectorAll('.opcao-item input')).map(input => input.value);
                                
                                // Criar template com as opções
                                const inputTemplate = createInputTemplate(pergunta, tipoResposta, opcoes, campoOutro);
                                
                                childrenContainer.insertAdjacentHTML('beforeend', inputTemplate);
                                
                                if (childrenContainer && !childrenContainer.sortable) {
                                    Sortable.create(childrenContainer, {
                                        animation: 150,
                                        handle: '.drag-handle',
                                        ghostClass: 'card-de-etapa-ghost',
                                        chosenClass: 'card-de-etapa-chosen',
                                        dragClass: 'card-de-etapa-drag',
                                        group: 'nested',
                                        onStart: function(evt) {
                                            document.body.classList.add('dragging-card');
                                        },
                                        onEnd: function(evt) {
                                            document.body.classList.remove('dragging-card');
                                            const item = evt.item;
                                            item.classList.add('highlight-card');
                                            setTimeout(() => {
                                                item.classList.remove('highlight-card');
                                            }, 800);
                                        }
                                    });
                                }
                            }
                    
                            // Fechar o modal
                            const modal = bootstrap.Modal.getInstance(document.getElementById('modalSelecao'));
                            modal.hide();
                        });
                    });
                    </script>
                    
                    <style>
                    .opcao-item .drag-handle {
                        cursor: move;
                        color: #6c757d;
                    }
                    
                    .opcao-ghost {
                        opacity: 0.5;
                        background: #f8f9fa;
                    }
                    
                    .opcoes-container {
                        min-height: 50px;
                    }
                    </style>
    <!-- modal de Envio de Arquivo -->
                        <div class="modal fade" id="modalArquivo" aria-hidden="true" tabindex="-1">
                            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div class="d-flex align-items-center gap-2">
                                            <img src="componentes-etapas/icones-componentes-etapas/icone-arquivo.svg" alt="Envio de Arquivo">
                                            <h5 class="modal-title">Envio de Arquivo</h5>
                                        </div>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p class="text-muted">Arquivo como uma imagem ou um documento.</p>
                                        <!-- opções base para todos os componentes -->
                                        <div class="mb-3">
                                          <label for="pergunta" class="form-label">Pergunta*</label>
                                          <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                                            <label class="form-check-label" for="campo-obrigatorio">
                                              Campo obrigatório
                                          </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                          <label for="ajuda" class="form-label">Ajuda</label>
                                          <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                                        </div>
                                        
                                        <div class="mb-3">
                                          <label for="aviso" class="form-label">Aviso</label>
                                          <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                                        </div>
                                        
                                        
                                        <div class="configuracoes">
                                            <h3>Configurações</h3>
                                            
                                            <!-- Quantidade de arquivos -->
                                            <div class="mb-3">
                                                <label class="form-label d-flex justify-content-between align-items-center">
                                                    <span>Quantidade máxima de arquivos</span>
                                                    <span class="badge bg-primary" id="quantidadeArquivosDisplay">1 arquivo</span>
                                                </label>
                                                <input type="range" class="form-range" id="quantidadeArquivos" 
                                                       min="1" max="20" value="1" 
                                                       oninput="this.nextElementSibling.value = this.value">
                                            </div>
                        
                                            <!-- Tipos de arquivo permitidos -->
                                            <div class="mb-3">
                                                <label class="form-label">Tipos de arquivo permitidos</label>
                                                <div class="d-flex flex-wrap gap-4">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="permitirPDF" checked>
                                                        <label class="form-check-label" for="permitirPDF">PDF</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="permitirImagens" checked>
                                                        <label class="form-check-label" for="permitirImagens">Imagens</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="permitirDOC">
                                                        <label class="form-check-label" for="permitirDOC">DOC/DOCX</label>
                                                    </div>
                                                </div>
                                            </div>
                        
                                            <!-- Tamanho máximo -->
                                            <div class="mb-3">
                                                <label class="form-label d-flex justify-content-between align-items-center">
                                                    <span>Tamanho máximo por arquivo</span>
                                                    <span class="badge bg-primary" id="tamanhoMaximoDisplay">10 MB</span>
                                                </label>
                                                <input type="range" class="form-range" id="tamanhoMaximo" 
                                                       min="1" max="100" value="10" 
                                                       oninput="this.nextElementSibling.value = this.value">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <button type="button" class="btn btn-primary" id="btnSalvarArquivo">Salvar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const quantidadeArquivos = document.getElementById('quantidadeArquivos');
                            const quantidadeArquivosDisplay = document.getElementById('quantidadeArquivosDisplay');
                            const tamanhoMaximo = document.getElementById('tamanhoMaximo');
                            const tamanhoMaximoDisplay = document.getElementById('tamanhoMaximoDisplay');
                        
                            // Atualizar o display quando o slider de quantidade muda
                            quantidadeArquivos.addEventListener('input', function() {
                                const valor = this.value;
                                quantidadeArquivosDisplay.textContent = valor === '1' ? '1 arquivo' : `${valor} arquivos`;
                            });
                        
                            // Atualizar o display quando o slider de tamanho muda
                            tamanhoMaximo.addEventListener('input', function() {
                                const valor = this.value;
                                tamanhoMaximoDisplay.textContent = `${valor} MB`;
                            });
                        
                            // Configurar o botão de salvar
                            const btnSalvarArquivo = document.getElementById('btnSalvarArquivo');
                            if (btnSalvarArquivo) {
                                btnSalvarArquivo.addEventListener('click', function() {
                                    // Obter os valores do formulário
                                    const quantidade = document.getElementById('quantidadeArquivos').value;
                                    const permitePDF = document.getElementById('permitirPDF').checked;
                                    const permiteImagens = document.getElementById('permitirImagens').checked;
                                    const permiteDOC = document.getElementById('permitirDOC').checked;
                                    const tamanhoMaximo = document.getElementById('tamanhoMaximo').value;
                                    
                                    // Aqui você pode adicionar a lógica para salvar as configurações
                                    
                                    // Fechar o modal
                                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalArquivo'));
                                    modal.hide();
                                });
                            }
                        });
                        </script>
    <!-- modal de Data -->
                            <div class="modal fade" id="modalData" aria-hidden="true" tabindex="-1">
                                <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <div class="d-flex align-items-center gap-2">
                                                <img src="componentes-etapas/icones-componentes-etapas/icone-data.svg" alt="Data">
                                                <h5 class="modal-title">Data</h5>
                                            </div>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <p class="text-muted">Seleciona um dia específico dentro dos limites definidos.</p>
                                            <!-- opções base para todos os componentes -->
                                            <div class="mb-3">
                                              <label for="pergunta" class="form-label">Pergunta*</label>
                                              <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                                            </div>
                                            
                                            <div class="mb-3">
                                              <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                                                <label class="form-check-label" for="campo-obrigatorio">
                                                  Campo obrigatório
                                              </div>
                                            </div>
                                            
                                            <div class="mb-3">
                                              <label for="ajuda" class="form-label">Ajuda</label>
                                              <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                                            </div>
                                            
                                            <div class="mb-3">
                                              <label for="aviso" class="form-label">Aviso</label>
                                              <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                                            </div>
                                            
                                            
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="button" class="btn btn-primary" id="btnSalvarData">Salvar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <script>
                            document.addEventListener('DOMContentLoaded', function() {
                                const btnSalvarData = document.getElementById('btnSalvarData');
                            
                                // Handle save button click
                                btnSalvarData.addEventListener('click', function() {
                                    // Get the parent card where the create-child button was clicked
                                    const parentCard = document.querySelector('.card-de-etapa .criar-filho.active')?.closest('.card-de-etapa');
                                    if (parentCard) {
                                        const childrenContainer = parentCard.querySelector('.children');
                                        
                                        // Get form values
                                        const pergunta = document.getElementById('pergunta').value || 'Nova pergunta';
                                        const campoObrigatorio = document.getElementById('campo-obrigatorio').checked;
                                        const ajuda = document.getElementById('ajuda').value;
                                        const aviso = document.getElementById('aviso').value;
                                        
                                        // Create new input template with the form values
                                        const inputTemplate = createInputTemplate(pergunta);
                                        
                                        // Add the template to the children container
                                        childrenContainer.insertAdjacentHTML('beforeend', inputTemplate);
                                        
                                        // Initialize sortable for the new children container if not already initialized
                                        if (childrenContainer && !childrenContainer.sortable) {
                                            Sortable.create(childrenContainer, {
                                                animation: 150,
                                                handle: '.drag-handle',
                                                ghostClass: 'card-de-etapa-ghost',
                                                chosenClass: 'card-de-etapa-chosen',
                                                dragClass: 'card-de-etapa-drag',
                                                group: 'nested',
                                                onStart: function(evt) {
                                                    document.body.classList.add('dragging-card');
                                                },
                                                onEnd: function(evt) {
                                                    document.body.classList.remove('dragging-card');
                                                    const item = evt.item;
                                                    item.classList.add('highlight-card');
                                                    setTimeout(() => {
                                                        item.classList.remove('highlight-card');
                                                    }, 800);
                                                }
                                            });
                                        }
                                    }
                            
                                    // Close the modal
                                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalData'));
                                    modal.hide();
                                });
                            });
                            </script>
    <!-- modal de Email -->
                                <div class="modal fade" id="modalEmail" aria-hidden="true" tabindex="-1">
                                    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <div class="d-flex align-items-center gap-2">
                                                    <img src="componentes-etapas/icones-componentes-etapas/icone-email.svg" alt="Email">
                                                    <h5 class="modal-title">Email</h5>
                                                </div>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <p class="text-muted">Email com validação de formato.</p>
                                                <!-- opções base para todos os componentes -->
                                                <div class="mb-3">
                                                  <label for="pergunta" class="form-label">Pergunta*</label>
                                                  <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                                                </div>
                                                
                                                <div class="mb-3">
                                                  <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                                                    <label class="form-check-label" for="campo-obrigatorio">
                                                      Campo obrigatório
                                                  </div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                  <label for="ajuda" class="form-label">Ajuda</label>
                                                  <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                                                </div>
                                                
                                                <div class="mb-3">
                                                  <label for="aviso" class="form-label">Aviso</label>
                                                  <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                                                </div>
                                                
                                                
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                                <button type="button" class="btn btn-primary" id="btnSalvarEmail">Salvar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <script>
                                document.addEventListener('DOMContentLoaded', function() {
                                    const btnSalvarEmail = document.getElementById('btnSalvarEmail');
                                
                                    // Handle save button click
                                    btnSalvarEmail.addEventListener('click', function() {
                                        // Get the parent card where the create-child button was clicked
                                        const parentCard = document.querySelector('.card-de-etapa .criar-filho.active')?.closest('.card-de-etapa');
                                        if (parentCard) {
                                            const childrenContainer = parentCard.querySelector('.children');
                                            
                                            // Get form values
                                            const pergunta = document.getElementById('pergunta').value || 'Nova pergunta';
                                            const campoObrigatorio = document.getElementById('campo-obrigatorio').checked;
                                            const ajuda = document.getElementById('ajuda').value;
                                            const aviso = document.getElementById('aviso').value;
                                            
                                            // Create new input template with the form values
                                            const inputTemplate = createInputTemplate(pergunta);
                                            
                                            // Add the template to the children container
                                            childrenContainer.insertAdjacentHTML('beforeend', inputTemplate);
                                            
                                            // Initialize sortable for the new children container if not already initialized
                                            if (childrenContainer && !childrenContainer.sortable) {
                                                Sortable.create(childrenContainer, {
                                                    animation: 150,
                                                    handle: '.drag-handle',
                                                    ghostClass: 'card-de-etapa-ghost',
                                                    chosenClass: 'card-de-etapa-chosen',
                                                    dragClass: 'card-de-etapa-drag',
                                                    group: 'nested',
                                                    onStart: function(evt) {
                                                        document.body.classList.add('dragging-card');
                                                    },
                                                    onEnd: function(evt) {
                                                        document.body.classList.remove('dragging-card');
                                                        const item = evt.item;
                                                        item.classList.add('highlight-card');
                                                        setTimeout(() => {
                                                            item.classList.remove('highlight-card');
                                                        }, 800);
                                                    }
                                                });
                                            }
                                        }
                                
                                        // Close the modal
                                        const modal = bootstrap.Modal.getInstance(document.getElementById('modalEmail'));
                                        modal.hide();
                                    });
                                });
                                </script>
    <!-- modal de Celular -->
                                    <div class="modal fade" id="modalCelular" aria-hidden="true" tabindex="-1">
                                        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <img src="componentes-etapas/icones-componentes-etapas/icone-celular.svg" alt="Celular">
                                                        <h5 class="modal-title">Celular</h5>
                                                    </div>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <p class="text-muted">Número de celular com validação e máscara.</p>
                                                    <!-- opções base para todos os componentes -->
                                                    <div class="mb-3">
                                                      <label for="pergunta" class="form-label">Pergunta*</label>
                                                      <input type="text" class="form-control" id="pergunta" name="pergunta" required>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                      <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="campo-obrigatorio" value="" checked>
                                                        <label class="form-check-label" for="campo-obrigatorio">
                                                          Campo obrigatório
                                                      </div>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                      <label for="ajuda" class="form-label">Ajuda</label>
                                                      <input type="text" class="form-control" id="ajuda" name="ajuda" placeholder="Deixe em branco para não exibir">
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                      <label for="aviso" class="form-label">Aviso</label>
                                                      <textarea class="form-control" id="aviso" name="aviso" rows="3" placeholder="Deixe em branco para não exibir"></textarea>
                                                    </div>
                                                    
                                                    
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                                    <button type="button" class="btn btn-primary" id="btnSalvarCelular">Salvar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <script>
                                    document.addEventListener('DOMContentLoaded', function() {
                                        const btnSalvarCelular = document.getElementById('btnSalvarCelular');
                                    
                                        // Handle save button click
                                        btnSalvarCelular.addEventListener('click', function() {
                                            // Get the parent card where the create-child button was clicked
                                            const parentCard = document.querySelector('.card-de-etapa .criar-filho.active')?.closest('.card-de-etapa');
                                            if (parentCard) {
                                                const childrenContainer = parentCard.querySelector('.children');
                                                
                                                // Get form values
                                                const pergunta = document.getElementById('pergunta').value || 'Nova pergunta';
                                                const campoObrigatorio = document.getElementById('campo-obrigatorio').checked;
                                                const ajuda = document.getElementById('ajuda').value;
                                                const aviso = document.getElementById('aviso').value;
                                                
                                                // Create new input template with the form values
                                                const inputTemplate = createInputTemplate(pergunta);
                                                
                                                // Add the template to the children container
                                                childrenContainer.insertAdjacentHTML('beforeend', inputTemplate);
                                                
                                                // Initialize sortable for the new children container if not already initialized
                                                if (childrenContainer && !childrenContainer.sortable) {
                                                    Sortable.create(childrenContainer, {
                                                        animation: 150,
                                                        handle: '.drag-handle',
                                                        ghostClass: 'card-de-etapa-ghost',
                                                        chosenClass: 'card-de-etapa-chosen',
                                                        dragClass: 'card-de-etapa-drag',
                                                        group: 'nested',
                                                        onStart: function(evt) {
                                                            document.body.classList.add('dragging-card');
                                                        },
                                                        onEnd: function(evt) {
                                                            document.body.classList.remove('dragging-card');
                                                            const item = evt.item;
                                                            item.classList.add('highlight-card');
                                                            setTimeout(() => {
                                                                item.classList.remove('highlight-card');
                                                            }, 800);
                                                        }
                                                    });
                                                }
                                            }
                                    
                                            // Close the modal
                                            const modal = bootstrap.Modal.getInstance(document.getElementById('modalCelular'));
                                            modal.hide();
                                        });
                                    });
                                    </script>
    <!-- modal de Lógica -->
                                        <div class="modal fade" id="modalLogica" aria-hidden="true" tabindex="-1">
                                            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <div class="d-flex align-items-center gap-2">
                                                            <img src="componentes-etapas/icones-componentes-etapas/icone-logica.svg" alt="Logica">
                                                            <h5 class="modal-title">Lógica</h5>
                                                        </div>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <p class="text-muted">Este componente define quais campos serão exibidos dependendo da resposta escolhida anteriormente.</p>
                                        
                                                        <div class="mb-3">
                                                            <label class="form-label">Resposta do campo predecessor</label>
                                                            <!-- tem que carregar dinamicamente as respostas do campo predecessor -->
                                                            <select class="form-select" id="respostaPredecessor">
                                                                <option>Sim</option>
                                                                <option>Não</option>
                                                            </select>
                                                        </div>
                                        
                                                        <div class="mb-3">
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="geraSolicitacao">
                                                                <label class="form-check-label" for="geraSolicitacao">
                                                                    Gera uma solicitação
                                                                </label>
                                                            </div>
                                                        </div>
                                        
                                                        <div id="camposSolicitacao" style="display: none;">
                                                            <div class="mb-3">
                                                                <label class="form-label">Finalidade*</label>
                                                                <input type="text" class="form-control" placeholder="Descrever aqui...">
                                                            </div>
                                        
                                                            <div class="mb-3">
                                                                <label class="form-label">Tipo de solicitação*</label>
                                                                <select class="form-select">
                                                                    <option>Escolher...</option>
                                                                </select>
                                                            </div>
                                        
                                                            <div class="mb-3">
                                                                <label class="form-label">Data de divulgação do resultado*</label>
                                                                <input type="text" class="form-control" placeholder="DD/MM/AAAA - HH:MM">
                                                            </div>
                                        
                                                            <div class="mb-3">
                                                                <label class="form-label">Período de interposição de recurso*</label>
                                                                <div class="row">
                                                                    <div class="col">
                                                                        <input type="text" class="form-control" placeholder="DD/MM/AAAA - HH:MM">
                                                                    </div>
                                                                    <div class="col">
                                                                        <input type="text" class="form-control" placeholder="DD/MM/AAAA - HH:MM">
                                                                    </div>
                                                                </div>
                                                            </div>
                                        
                                                            <div class="mb-3">
                                                                <label class="form-label">Data de divulgação do resultado do recurso*</label>
                                                                <input type="text" class="form-control" placeholder="DD/MM/AAAA - HH:MM">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                                        <button type="button" class="btn btn-primary" id="btnSalvarLogica">Salvar</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <script>
                                        document.addEventListener('DOMContentLoaded', function() {
                                            const geraSolicitacao = document.getElementById('geraSolicitacao');
                                            const camposSolicitacao = document.getElementById('camposSolicitacao');
                                            const btnSalvarLogica = document.getElementById('btnSalvarLogica');
                                        
                                            // Toggle campos de solicitação
                                            geraSolicitacao.addEventListener('change', function() {
                                                camposSolicitacao.style.display = this.checked ? 'block' : 'none';
                                            });
                                        
                                            // Handle save button click
                                            btnSalvarLogica.addEventListener('click', function() {
                                                // Get the parent card where the create-child button was clicked
                                                const parentCard = document.querySelector('.card-de-etapa .criar-filho.active')?.closest('.card-de-etapa');
                                                if (parentCard) {
                                                    const childrenContainer = parentCard.querySelector('.children');
                                                    
                                                    // Create new logic template
                                                    const logicTemplate = createLogicTemplate('Nova lógica');
                                                    
                                                    // Add the template to the children container
                                                    childrenContainer.insertAdjacentHTML('beforeend', logicTemplate);
                                                    
                                                    // Initialize sortable for the new children container if not already initialized
                                                    if (childrenContainer && !childrenContainer.sortable) {
                                                        Sortable.create(childrenContainer, {
                                                            animation: 150,
                                                            handle: '.drag-handle',
                                                            ghostClass: 'card-de-etapa-ghost',
                                                            chosenClass: 'card-de-etapa-chosen',
                                                            dragClass: 'card-de-etapa-drag',
                                                            group: 'nested',
                                                            onStart: function(evt) {
                                                                document.body.classList.add('dragging-card');
                                                            },
                                                            onEnd: function(evt) {
                                                                document.body.classList.remove('dragging-card');
                                                                const item = evt.item;
                                                                item.classList.add('highlight-card');
                                                                setTimeout(() => {
                                                                    item.classList.remove('highlight-card');
                                                                }, 800);
                                                            }
                                                        });
                                                    }
                                                }
                                        
                                                // Close the modal
                                                const modal = bootstrap.Modal.getInstance(document.getElementById('modalLogica'));
                                                modal.hide();
                                            });
                                        });
                                        </script> 
    

    <!-- ================================= -->
    <!-- SCRIPTS ========================= -->
    <!-- ================================= -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Sortable.js para drag and drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- JS do date range picker e suas dependências (se utilizado) -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1/daterangepicker.min.js"></script>
    <!-- scripts do bootstrap -->
    <script src="js/bootstrap.js"></script>
    
    <!-- Adicionar * após o rótulo para cada campo de entrada obrigatório -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get all required input and select elements
            var requiredInputs = document.querySelectorAll('input[required], select[required]');
    
            // Loop through each required input/select element
            requiredInputs.forEach(function (input) {
                // Get the label for this input/select
                var label = document.querySelector('label[for="' + input.id + '"]');
    
                // If a label was found, add an asterisk to its text
                if (label) {
                    label.innerHTML += ' <span class="text-danger">*</span>';
                }
            });
        });
    </script>
    <!-- Script específico para o construtor de etapas -->
    <script src="js/componentes.js"></script>
    <script src="js/etapas-builder.js"></script>
    <script>
      $(document).ready(function() {
        // Clear and focus the filter input when modal is shown
        $('#modalComponentes').on('shown.bs.modal', function() {
          $('#filtroComponentes').val('').focus();
          $('#opcoes-de-componentes-para-incluir .list-group-item').removeClass('d-none');
        });

        // Filter items as user types
        $('#filtroComponentes').on('input', function() {
          const searchTerm = $(this).val().toLowerCase();
          const listItems = $('#opcoes-de-componentes-para-incluir .list-group-item');
          
          listItems.each(function() {
            const title = $(this).find('.component-title').text().toLowerCase();
            const description = $(this).find('.component-description').text().toLowerCase();
            
            if (title.includes(searchTerm) || description.includes(searchTerm)) {
              $(this).removeClass('d-none');
            } else {
              $(this).addClass('d-none');
            }
          });
        });

        // Handle keyboard navigation
        $('#filtroComponentes').on('keydown', function(e) {
          const visibleItems = $('#opcoes-de-componentes-para-incluir .list-group-item:not(.d-none)');
          const currentItem = visibleItems.filter(':focus');
          let nextItem;

          switch(e.keyCode) {
            case 40: // Down arrow
              e.preventDefault();
              if (currentItem.length === 0) {
                nextItem = visibleItems.first();
              } else {
                nextItem = currentItem.nextAll('.list-group-item:not(.d-none)').first();
                if (nextItem.length === 0) {
                  nextItem = visibleItems.first();
                }
              }
              nextItem.focus();
              break;

            case 38: // Up arrow
              e.preventDefault();
              if (currentItem.length === 0) {
                nextItem = visibleItems.last();
              } else {
                nextItem = currentItem.prevAll('.list-group-item:not(.d-none)').first();
                if (nextItem.length === 0) {
                  nextItem = visibleItems.last();
                }
              }
              nextItem.focus();
              break;

            case 13: // Enter
              e.preventDefault();
              if (currentItem.length) {
                currentItem.trigger('click');
              }
              break;
          }

          // Scroll item into view if needed
          const focusedItem = visibleItems.filter(':focus');
          if (focusedItem.length) {
            const container = $('#opcoes-de-componentes-para-incluir');
            const itemTop = focusedItem.position().top;
            const containerHeight = container.height();
            const itemHeight = focusedItem.outerHeight();

            if (itemTop < 0) {
              container.scrollTop(container.scrollTop() + itemTop);
            } else if (itemTop + itemHeight > containerHeight) {
              container.scrollTop(container.scrollTop() + itemTop + itemHeight - containerHeight);
            }
          }
        });

      });
    </script>
  </body>
</html>